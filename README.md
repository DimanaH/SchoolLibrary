Документация на проекта "SchoolLibrary"

========================================================================

1. Въведение
SchoolLibrary е уеб приложение за управление на библиотечния фонд, потребители, заеми на книги и администриране на библиотечния процес в малка библиотека като училищна. Системата позволява на администраторите (библиотекари) да управляват потребителите и техните роли, а на учениците и учителите – да следят своите заемки и профил.


========================================================================

2. Технологии и инструменти
Backend: ASP.NET Core 8
Frontend: Razor Pages / MVC
База данни: Microsoft SQL Server
Identity Framework: ASP.NET Core Identity
ORM: Entity Framework Core
Authentication: Identity + Cookie-based Authentication
Logging: ILogger
Dependency Injection: Вграден DI контейнер на ASP.NET Core

========================================================================

3. Архитектура на проекта
Проектът SchoolLibrary следва MVC (Model-View-Controller) архитектурния модел, като включва няколко слоя, които разделят логиката на приложението. В допълнение, проектът използва Dependency Injection (DI) за по-добра модулност и лесна поддръжка.  

 3.1. Основни слоеве  
Архитектурата е разделена на няколко логически слоя:

 1️ Models (Модели)
- Описание: Моделите са класове, които представят основните обекти в системата и дефинират тяхната структура и връзки.  
- Функция: Те описват данните, които се използват в приложението, и се свързват с базата данни чрез Entity Framework Core.  

 Примерни модели:
- LibraryUser – Представлява потребителите на библиотеката.  
- Book – Представлява книгите в библиотеката.  
- Borrowing – Записва заемките на книги.  
- LoginHistory – Съхранява информация за входовете на потребителите.  

 2️ Controllers (Контролери)
- Описание: Контролерите обработват HTTP заявките и управляват взаимодействието между моделите и изгледите.  
- Функция: Получават входни данни, обработват ги чрез услуги (Services) и връщат отговор на клиента.  

 Примерни контролери:
- LibraryUsersController – Управлява потребителите.  
- BooksController – Управлява операциите с книги.  
- BorrowingsController – Обработва заемите на книги.  


 3️ Views (Изгледи)
- Описание: Генерират HTML съдържанието за потребителите чрез Razor Pages.  
- Функция: Представят данните от контролерите на потребителя във визуално разбираем вид.  

 Основни изгледи:
- Views/Home/Index.cshtml – Началната страница.  
- Views/Books/Index.cshtml – Списък с книги.  
- Views/LibraryUsers/Index.cshtml – Списък с потребители.  

 4️ Services (Услуги)
- Описание: Отделни класове за обработка на бизнес логика, за да не се натоварват контролерите.  
- Функция: Те съдържат специфични операции, като например обработка на заемките.  

 Примерна услуга `BorrowingService`

 5️ Data (База данни и Entity Framework Core)
- Описание: Съдържа `ApplicationDbContext`, който управлява връзката с базата данни.  
- Функция: Посредничи между моделите и базата чрез Entity Framework Core.  

 3.2. Взаимодействие между слоевете
	1. Потребителят изпраща заявка (например за заемане на книга).  
	2. Controller обработва заявката и извиква метод от Service слоя.  
	3. Service проверява данните и комуникира с Data слоя.  
	4. Data слоя записва данните в базата чрез Entity Framework Core.  
	5. Контролерът връща резултат на View слоя, който показва информацията на потребителя.  

 3.3. Обобщение на архитектурата
| Слой | Отговорност |
|------|------------|
| Models | Описват структурата на данните |
| Controllers | Обработват HTTP заявки |
| Views | Генерират HTML за потребителя |
| Services | Изпълняват бизнес логиката |
| Data | Управлява връзката с базата данни |

=======================================================================

 4. Функционалности на системата

Проектът SchoolLibrary предоставя следните основни функционалности:

 4.1. Управление на потребители
 1. Регистрация и логин чрез ASP.NET Core Identity
- Потребителите (ученици и учители) се регистрират от администратора (библиотекар) въз основа на предоставени от тях данни  като име, фамилия, дата на раждане, емайл, парола за самостоятелен достъп до функционалностите на системата и др.. 
Въз основа на въведените данни администратора може да извърхва търсене и филтриране на потребителите по зададен критерий.
- Входът се осъществява чрез ASP.NET Core Identity, като се поддържа запомняне на потребителя (Remember Me).  

 Процес на логин:
1. Потребителят въвежда имейл и парола.
2. Системата проверява дали данните са валидни.
3. Ако влизането е успешно, потребителят се пренасочва към началната страница.
4. Ако влизането е неуспешно, се показва грешка.


 2. Роли и права на достъп
 В проекта има три роли:  
- Администратор – Има пълен достъп до всички функционалности.Може да добавя и управлява книги потребители и заемки.  
- Студент – Може да разглежда каталога от книги и собствените си заемки.  
- Учител – Може да разглежда каталога от книги и собствените си заемки.  
 Достъпът е контролиран чрез правата дадени на отделните роли.

 3. Управление на профил и промяна на парола
- Администраторите могат да променят профилните данни и паролата на всички потребители.
- Потребителите могат да променят само своята парола.  

 4.2. Управление на книги
 1. Добавяне, редактиране и изтриване на книги
 Администраторът, библиотекар може да управлява списъка с книги.  
 При създаване се въвеждат:
- Инвентарен номер
- Заглавие  
- Автор  
- Жанр  
- Издателство
- Година на издаване
- Дата на инвентиране  
 2. Въз основа на въведените данни администратора може да извърхва търсене и филтриране на книгите по зададен критерий.

 4.3. Управление на заемки
 1. Заемане на книги и връщане
- Потребителят избира книга и администратора (библиотекар) въвежда заявка за заемане.  
- Системата проверява дали книгата е налична.  
- Създава се запис в таблицата `Borrowings` и книгата се маркира като заета.  
- При връщане на книга това се отразява в записа на заемката и книгата се маркира като свободна.
 2. Проследяване на активни заеми
- Администраторът осъжествява търсене, филтриране на текущите заемки:  
- Потребителят може да види активните си заемки и датите на връщане.  

 4.4. История на логините
 1. Запазване на IP адрес и дата на логин
 При всяко успешно влизане се записва информация за:  
- Потребител  
- Дата и час на входа  
- IP адрес 
 При всяко успешно излизане се записва информация за дата и час на изхода.  
 2. Администраторите могат да преглеждат и изтриват логовете.

Обобщение на функционалностите на системата:
- Управление на потребители – Регистрация, роли, логин история.  
- Управление на книги – Добавяне, редактиране, категоризиране.  
- Управление на заеми – Проследяване на активни заеми и връщане.  
- Сигурност – Запазване на IP адрес и логове за сигурност.  

========================================================================

5. База данни

Създаване на базата данни
При изграждането на базата данни на приложението е използван Code First подход- първо се създават моделите на данни, а базата данни се генерира автоматично от тези модели. Този подход позволява по-лесна и гъвкава работа с моделите на данни, като разработчиците имат пълен контрол върху тях. Методът за създаване на базата данни включва използването на Entity Framework за манипулиране на базата данни. 
Модел на данните (Data Model) 
Първо създаваме модел на данните, който описва структурата на данните, които искаме да съхраняваме в базата данни. В нашия случай, моделите са класовете Book, LibraryUser, Borrowing, LoginHistory.

Основните таблици са:

5.1. Таблица: LibraryUsers
Колона	Тип	Описание
Id	string	Уникален идентификатор
FirstName	string	Собствено име
LastName	string	Фамилия
Email	string	Имейл
Role	string	Потребителска роля

5.2. Таблица: Books
Колона	Тип	Описание
Id	int	Уникален идентификатор
Title	string	Заглавие на книгата
Author	string	Автор

5.3. Таблица: Borrowings
Колона	Тип	Описание
Id	int	Уникален идентификатор
BookId	int	Книга
UserId	string	Потребител
BorrowDate	DateTime	Дата на заемане

6. API и маршрути
6.1. Потребители
GET /LibraryUsers/Index – Списък с потребители
POST /LibraryUsers/Create – Добавяне на нов потребител
POST /LibraryUsers/Edit/{id} – Промяна на потребител
6.2. Книги
GET /Books/Index – Всички книги
POST /Books/Create – Добавяне на книга
POST /Books/Delete/{id} – Изтриване
6.3. Заемки
POST /Borrowings/Create – Заемане на книга
POST /Borrowings/Return/{id} – Връщане на книга

========================================================================
